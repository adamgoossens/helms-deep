##############################
#
# Secret needed for accessing Tower using AnsibleJob resources
#
# Used for running playbooks during Application rollout/cleanup
#
##############################
---
- tags:
  - acm
  block:
  - name: acs - create secret for launching Tower jobs
    kubernetes.core.k8s:
      definition:
        apiVersion: v1
        kind: Secret
        metadata:
          name: toweraccess
          namespace: helms-deep
        stringData:
          token: "{{ vault_acm_aap_token }}"
          host: "{{ ansible_tower_url }}"
    when:
      - ansible_tower_url is defined
