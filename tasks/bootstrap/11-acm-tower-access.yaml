##############################
#
# Secret needed for accessing Tower using AnsibleJob resources
#
# Used for running playbooks during Application rollout/cleanup
#
##############################
---
- name: acs - create secret for launching Tower jobs
  community.kubernetes.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: toweraccess
        namespace: helms-deep
      stringData:
        token: "{{ vault_acm_aap_token }}"
        host: "{{ ansible_tower_url }}"
  when:
    - ansible_tower_url is defined
