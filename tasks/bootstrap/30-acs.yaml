---
- name: acs - deploy ACS Helm chart
  community.kubernetes.helm:
    name: stackrox-central-services
    chart_ref: '{{ acs.central.chart_ref }}'
    release_namespace: stackrox
    release_values: "{{ acs.central.helmValues }}"
    wait: true
  register: acs_helm_out

- name: acs - get central route
  community.kubernetes.k8s_info:
    api_version: route.openshift.io/v1
    kind: Route
    name: central
    namespace: stackrox
  register: central_route

- set_fact:
    console_links: "{{ console_link|default([]) + [acs_link] }}"
  vars:
    acs_link:
      name: acs
      applicationMenu:
        section: Red Hat Applications
      href: "https://{{ central_route.resources[0].spec.host }}"
      location: ApplicationMenu
      text: Red Hat Advanced Cluster Security for Kubernetes

- include_tasks: tasks/acs/deploy-collector.yaml
  vars:
    cluster_name: "central"
